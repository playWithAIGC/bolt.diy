# Build configuration
build:
  buildCommand: |
    npm install -g pnpm && 
    pnpm install &&
    pnpm run build &&
    mkdir -p build/functions &&
    cp -r functions/* build/functions/ &&
    cd build/functions &&
    npm init -y &&
    npm install @remix-run/cloudflare-pages @remix-run/cloudflare &&
    echo '{ "type": "module", "dependencies": { "@remix-run/cloudflare-pages": "^2.15.0", "@remix-run/cloudflare": "^2.15.0" } }' > package.json &&
    echo 'export { createPagesFunctionHandler } from "@remix-run/cloudflare-pages"' > _worker.js
  buildOutputDirectory: build/client
  nodeVersion: 20.18.0

# Environment variables
environment:
  production:
    NODE_VERSION: "20"
    NPM_VERSION: "10"
    VITE_LOG_LEVEL: "debug"
    DEFAULT_NUM_CTX: "32768"
  preview:
    NODE_VERSION: "20"
    NPM_VERSION: "10"
    VITE_LOG_LEVEL: "debug"
    DEFAULT_NUM_CTX: "32768" 